name: C/C++ CI docker

on: [push]

jobs:
  build:
    strategy:
      matrix:
        include:
        - os: windows-latest
          dockerfile: Dockerfile.windows
          arch: windows        
        - os: ubuntu-latest
          dockerfile: Dockerfile.arm64
          arch: arm64
        - os: ubuntu-latest
          dockerfile: Dockerfile.rpi
          arch: armv6l
          crosscompiler: https://sourceforge.net/projects/raspberry-pi-cross-compilers/files/Raspberry%20Pi%20GCC%20Cross-Compiler%20Toolchains/Buster/GCC%2010.2.0/Raspberry%20Pi%201%2C%20Zero/cross-gcc-10.2.0-pi_0-1.tar.gz          
        - os: ubuntu-latest
          dockerfile: Dockerfile.rpi
          arch: armv7l
          crosscompiler: https://sourceforge.net/projects/raspberry-pi-cross-compilers/files/Raspberry%20Pi%20GCC%20Cross-Compiler%20Toolchains/Buster/GCC%2010.2.0/Raspberry%20Pi%202%2C%203/cross-gcc-10.2.0-pi_2-3.tar.gz                
        - os: ubuntu-latest
          dockerfile: Dockerfile
          arch: amd64

    runs-on: ${{ matrix.os }}
    
    steps:
    - uses: actions/checkout@v4

    - name: Build an image from Dockerfile
      run: docker build -t docker.io/${{ github.repository }}:${{ matrix.arch }} -f ${{ matrix.dockerfile }} --build-arg CROSSCOMPILE=${{ matrix.crosscompiler }} --build-arg ARCH=${{ matrix.arch }} .
